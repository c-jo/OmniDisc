<?xml version="1.0"?>
<!DOCTYPE riscos-prm PUBLIC "-//Gerph//DTD PRM documentation 1.02//EN"
                            "http://gerph.org/dtd/102/prm.dtd">

<riscos-prm>
<chapter title="File system management tools">
<section title="Introduction">
<p>
The formatting tools differ between those that can be used by the Floppy disc filing systems, and the HardDisc filing systems. They also differ between the different hardware drivers. The format tool in the desktop for floppies has traditionally been built into the Filer. The format tool for hard discs has traditionally been the command line tool HForm which required a lot of knowledge to make work correctly.
</p>

<p>
    Other tools are required for management of the filing system, such
    as tools to back up the whole filing system, check the filing system
    and verifying the media's integrity. Within the desktop the ADFS Filer provided some of these functions, but no general mechanism was provided to allow these functions to be shared.
</p>

<p>
    This chapter describes the means by which other filing systems can
    identify and invoke tools for managing the filing systems and media.
</p>
</section>

<section title="Overview">
<p>An overview of how the component is viewed by the outside world;
   what it does and the manner in which it does it.
</p>
<p>Sometimes the Introduction and the Overview are joined to make 'Introduction and
   Overview'.</p>
</section>


<section title="Terminology">

<list>
    <item><strong>Driver</strong>: A FileCore hardware driver, such as ADFS, SCSIFS or RAMFS. May support multiple **Devices**, currently up to 8 with the extant interface for FileCore discs.</item>

    <item><strong>Device</strong>: A physical or virtual device which may be used to access a <strong>Filing system</strong> through a <strong>Driver</strong>. Devices may be removeable, such as USB devices.</item>

    <item><strong>Disc</strong>: A set of logical blocks on a media provided by a <strong>Device</strong>. <strong>Discs</strong> may be removeable, such as 3 1/2" discs, SD cards or USB drives, or they may be attached, such as SATA hard discs.</item>

    <item><strong>Filing system</strong>: A layout on a <strong>Disc</strong> which provides access to files, using the logical block access provided by the <strong>Device</strong>.</item>

    <item><strong>Floppy disc</strong>: Within this document, a 'Floppy disc' is a disc which uses the FileCore mount and layout mechanism used by traditional floppy discs. As the FileCore layout for a Floppy disc differs from that for a Fixed disc, this differentiation is necessary.</item>

    <item><strong>Hard disc</strong>: Within this document, a 'Hard disc' is a disc which uses the FileCore mount and layout mechanism used by traditional hard discs. This differs from the <strong>Floppy disc</strong> layout in having a boot block and disc record.</item>

    <item><strong>Removeable</strong>: A disc which can be removed from the system at runtime. Options may be available to Eject the disc, as indicated by the FileCore flags.</item>

    <item><strong>Fixed</strong>: A disc which cannot be removed from the system.</item>

    <item><strong>Formatting</strong>: Erasing and laying out a **Filing system** on the **Disc**.</item>

    <item><strong>Checking</strong>**: Performing an integrity check of the **Filing system** on the **Disc**.</item>

    <item><strong>Verifying</strong>: Performing a check of the reliability of the <strong>Disc</strong> media. Does not involve the filing system.</item>

    <item><strong>Backing up</strong>: Duplicating the contents of the <strong>Filing system</strong> media.</item>
</list>
</section>


<section title="Technical details">

<subsection title="Filing system operations">
<p>
There are 4 major operations that are required for filing systems on discs:
</p>

<list>
    <item>Formatting - traditionally in ADFSFiler, *Format, or HForm.</item>
    <item>Verifying - traditionally in ADFSFiler, or *Verify.</item>
    <item>Checking - traditionally *CheckMap, or using the third party FSCK or DiskKnight.</item>
    <item>Backing up - traditionally *Backup.</item>
</list>

<p>
    For formatting, an existing service exists to determine what formats are available, but only for floppy discs. These formats are enumerated by <reference type="service" name="EnumerateFormats"/>. Filers area able to offer these options, in a menu or dialogue box, to format the disc in those formats for floppy discs using the 'Format' operation described here.
</p>

<p>
    The filing system operations can differentiate between those tools
    which are speific to a given driver, and those which are more general.
    This allows tools to be created which are suitable only for certain
    drivers, and those which can be used for any sort of driver.
</p>
</subsection>

<subsection title="Launching operations">
<p>
The protocol allows the operations to be started through *-commands
which are defined by system variables. These variables define the tools
which can be used to manage file systems.
</p>
</subsection>


</section>



<section title="System variables">
<sysvar-definition name="Sys$Variable"
                   description="What the variable holds">
<use>
<p>What the variable holds and its purpose</p>
</use>

<related>
<!-- <reference type="command" name="Com" /> -->
</related>
</sysvar-definition>
</section>


<section title="Wimp messages">
<p>
Lists the Wimp messages, using message-definition, which are generated
or received by this component.
</p>

<message-definition name="MyModuleAction"
                    number="90210"
                    description="What this message signifies"
                    broadcast="never"
                    recorded="may"
                    source="Tasks"
                    destination="Filer tasks">
<message-table>
  <message offset="20">Extra data in the message block</message>
</message-table>

<use>

<p>Why this message is sent, and what it means to receive it.</p>
</use>

<related>
  <reference type="message" name="MyModuleResponse" />
  <reference type="command" name="MyModuleCommand" />
</related>

</message-definition>
</section>


<section title="*Commands">
<p>
Lists the CLI commands, using command-definition, which are provided
by this component.
</p>

<command-definition name="CommandName"
                    description="What the command does">

<syntax>
  <optional>
    <switch name="d" />
  </optional>
  <userreplace>parameter</userreplace>
</syntax>

<parameter switch="d">
 what this switch does.
</parameter>

<parameter name="parameter">
 what the parameter means.
</parameter>

<use>
<p>What the command is used for.</p>
</use>

<example>
<command>*CommandName -d HelloThere!</command>
</example>


<related>
<reference type="command" name="AnotherCommand" />
</related>

</command-definition>

</section>


<section title="Examples">
<p>
Any long examples which describe the overall use of the component's
APIs.
</p>

<extended-example type='pseudo'>
/* Pseudo code doing something or other */
your_data = <userreplace>get data from user</userreplace>;
my_buffer = <userreplace>buffer allocation</userreplace>;

ok = copy_buffer(my_buffer, your_data);
if not ok
    return None;
transform(my_buffer);
return my_buffer;
</extended-example>

</section>

</chapter>

<!-- MetaData -->
<meta>
 <maintainer>
  <email name="Gerph" address="gerph@gerph.org" />
 </maintainer>
 <disclaimer>
    <p>
        &copy; Gerph, 2022.
    </p>
 </disclaimer>

 <history>
  <revision number="1" author="Gerph" date="02 Feb 2022" title="Initial version">
    <change>Created from original proposal.</change>
  </revision>
 </history>

 <related>
    <reference type='link' href="https://github.com/c-jo/OmniDisc" />
 </related>
</meta>
</riscos-prm>
