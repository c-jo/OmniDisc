#include <string.h>
#include <stddef.h>
#include <assert.h>

#include "Icon.h"

void test_match(void)
{
    Icon i1;

    // Should match any ADFS drive
    strcpy(i1.fs,    "ADFS");
    strcpy(i1.disc,  "");
    strcpy(i1.val,   "Stest1");
    i1.drive  = -1;
    i1.floppy = true;
    i1.winnie = true;

    assert(icon_match(&i1,"ADFS",4,"HardDisc4" )  > 0);
    assert(icon_match(&i1,"adfs",4,"HARDDISC4" )  > 0);
    assert(icon_match(&i1,"ADFS",0,"14_14_Fri" )  > 0);
    assert(icon_match(&i1,"Adfs",1,""          )  > 0);
    assert(icon_match(&i1,"SCSI",0,"Thumbdrive") == 0);
    assert(icon_match(&i1,"SDFS",4,"CardOne"   ) == 0);

    // Match hard drives only
    i1.floppy = false;
    assert(icon_match(&i1,"ADFS",4,"HardDisc4" )  > 0);
    assert(icon_match(&i1,"ADFS",0,"14_14_Fri" ) == 0);
    i1.floppy = true;

    // Match floppy discs only
    i1.winnie = false;
    assert(icon_match(&i1,"ADFS",4,"HardDisc4" ) == 0);
    assert(icon_match(&i1,"ADFS",0,"14_14_Fri" )  > 0);
    i1.winnie = true;

    // Match a disc name
    strcpy(i1.disc, "15_30_Tue");
    assert(icon_match(&i1,"ADFS",4,"HardDisc4" ) == 0);
    assert(icon_match(&i1,"adfs",0,"15_30_Tue" )  > 0);

    // Match a drive number
    strcpy(i1.disc, "");
    i1.drive = 4;
    assert(icon_match(&i1,"ADFS",4,"HardDisc4" )  > 0);
    assert(icon_match(&i1,"adfs",0,"15_30_Tue" ) == 0);
}

void test_compare(void)
{
    Icon i1, i2, i3, i4;
    i1.next = &i2;
    i2.next = &i3;
    i3.next = &i4;
    i4.next = NULL;

    // Should match any ADFS drive
    strcpy(i1.fs,    "ADFS");
    strcpy(i1.disc,  "");
    strcpy(i1.val,   "Stest1");
    i1.drive  = -1;
    i1.floppy = true;
    i1.winnie = true;

    // A given  drive number
    strcpy(i2.fs,   "ADFS");
    strcpy(i2.disc, "");
    strcpy(i2.val,  "Stest2");
    i2.drive  = 4;
    i2.floppy = true;
    i2.winnie = true;

    // A given disc name
    strcpy(i3.fs,   "ADFS");
    strcpy(i3.disc, "HardDisc4");
    strcpy(i3.val,  "Stest3");
    i3.drive  = -1;
    i3.floppy = true;
    i3.winnie = true;

    // A given disc name and drive number
    strcpy(i4.fs,   "ADFS");
    strcpy(i4.disc, "HardDisc4");
    strcpy(i4.val,  "Stest4");
    i4.drive  = 4;
    i4.floppy = true;
    i4.winnie = true;

    // A name match should be higher than drive number one
    assert(icon_match(&i3,"ADFS",4,"HardDisc4") > icon_match(&i2,"ADFS",4,"HardDisc4"));

    // A drive match is higher than a FS one
    assert(icon_match(&i2,"ADFS",4,"HardDisc4") > icon_match(&i1,"ADFS",4,"HardDisc4"));

    // Find an icon
    assert(!strcmp(icon_find(&i1, "ADFS",2,"03_04_Mon"), "Stest1"));
    assert(!strcmp(icon_find(&i1, "ADFS",4,"Winnie4"  ), "Stest2"));
    assert(!strcmp(icon_find(&i1, "ADFS",5,"HardDisc4"), "Stest3"));
    assert(!strcmp(icon_find(&i1, "ADFS",4,"HardDisc4"), "Stest4"));

    // Fall back to default
    assert(!strcmp(icon_find(&i1, "SDFS",0,"Card0"),   "Sfloppydisc"));
    assert(!strcmp(icon_find(&i1, "SCSI",4,"BigDisc"), "Sharddisc"  ));
}

void test_list(void)
{
    Icon *icons = 0;
    icons = icon_add(icons, "harddisc", "ADFS", "HardDisc4", 4);
    assert(icons != 0);
    assert(icons->next == 0);
    assert(!strcmp(icons->fs,   "ADFS"));
    assert(!strcmp(icons->disc, "HardDisc4"));
    assert(!strcmp(icons->val,  "Sharddisc"));

    icons = icon_add(icons, "harddisc", "ADFS", "HardDisc5", 5);
    assert(icons->next != 0);
    assert(!strcmp(icons->disc, "HardDisc4"));
    assert(!strcmp(icons->next->disc, "HardDisc5"));
    assert(icons->next->next == 0);

    icons = icon_remove(icons, "ADFS", "HardDisc4", 4);
    assert(icons != 0);
    assert(icons->next == 0);
    assert(!strcmp(icons->fs,   "ADFS"));
    assert(!strcmp(icons->disc, "HardDisc5"));
    assert(!strcmp(icons->val,  "Sharddisc"));

    icons = icon_remove(icons, "ADFS", "HardDisc4", 4);
    assert(icons != 0);
    assert(!strcmp(icons->disc, "HardDisc5"));

    icons = icon_add(icons, "harddisc", "ADFS", "HardDisc6", 6);
    icons = icon_remove(icons, "ADFS", "HardDisc6", 6);
    assert(icons != 0);
    assert(icons->next == 0);
    assert(!strcmp(icons->disc, "HardDisc5"));
}

void test_command(void)
{
    Icon *icons = 0;
    assert(0 == icon_command(&icons, "-fs ADFS -disc HardDisc4 switcher"));
    assert(icons != 0);
    assert(!strcmp(icons->fs,   "ADFS"));
    assert(!strcmp(icons->disc, "HardDisc4"));
    assert(!strcmp(icons->val,  "Sswitcher"));
    assert(icons->floppy == true);
    assert(icons->winnie == true);
    assert(icons->drive  == -1);
}

int main(void)
{
    test_match();
    test_compare();
    test_list();
    test_command();
    return 0;
}
