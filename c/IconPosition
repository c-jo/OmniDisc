#include "FilerX.h"

#ifdef DEBUG
#include <stdio.h>
#endif

void icon_position(Drive *drive, int *pos, int *icon)
{
    int clown = -2; // Clowns to the left of me
    int joker = -2; // Jokers to my right
    FS *fs;

    // Find an icon to put ours next to, if we can
    for (fs = fses; fs; fs = fs->next)
    {
        int n;
        for (n = 0; n < 8; ++n)
        {
            if (&fs->drive[n] == drive)
            {
                if (clown == -2)
                    clown = -1;
                joker = -1;
            }
            else
            {
                int bi = fs->drive[n].baricon;
                if (bi != -1)
                {
                    if (joker ==  -2)
                        clown = bi;
                    else if (joker == -1)
                        joker = bi;
                }
            }
#ifdef DEBUG
            printf("%s/%d:%d %d,%d\n", fs->name, n, fs->drive[n].baricon,
                                       clown, joker);
#endif
        }
    }

    if (clown >= 0)
    {
        *pos = -4;     // To the right of
        *icon = clown; // Icon to the left.
    }
    else if (joker >= 0)
    {
        *pos  = -3;    // To the left of
        *icon = joker; // Icon to the right.
    }
    else
    {
        *pos  = -5;         // Left side, high
        *icon = 0x70000000; // priority.
    }
}
