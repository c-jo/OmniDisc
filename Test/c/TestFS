#include <string.h>
#include <stddef.h>
#include <stdlib.h>
#include <assert.h>

#include "FS.h"

fsparameters_t *fsp_dup(fsparameters_t *src)
{
    fsparameters_t* z = malloc(sizeof(*src));
    memcpy(z, src, sizeof(*src));
    return z;
}

void test_list(void)
{
    FS *fs_list = NULL;
    FS *newfs1, *newfs2;
    int removed;
    fsparameters_t fsp1 = { "ADFS", "ADFS", 8 };
    fsparameters_t fsp2 = { "RamFS", "RAMFS", 23 };

    fs_list = fs_add(fs_list, fsp_dup(&fsp1), &newfs1);
    assert(fs_list != NULL);
    assert(newfs1  != NULL);
    assert(fs_list == newfs1);
    assert(fs_list->next == NULL);

    fs_list = fs_add(fs_list, fsp_dup(&fsp2), &newfs2);
    assert(newfs2  != NULL);
    assert(fs_list == newfs1);
    assert(fs_list->next == newfs2);

    fs_list = fs_remove(fs_list, "ADFS", &removed);
    assert(fs_list == newfs2);
    assert(fs_list->next == NULL);
    assert(removed == 1);

    fs_list = fs_add(fs_list, fsp_dup(&fsp1), &newfs1);
    assert(fs_list->next == newfs1);

    fs_list = fs_remove(fs_list, "RAMFS", &removed);
    assert(fs_list == newfs1);
    assert(removed == 1);
}

int main(void)
{
    test_list();
    return 0;
}
